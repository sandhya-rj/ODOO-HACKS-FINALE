{
  "contractVersion": "1.0",
  "generatedFrom": "backend/prisma/seed.js",
  "purpose": "Frontend integration testing with guaranteed insight triggers",
  
  "demoUsers": [
    {
      "userId": "learner4.id",
      "name": "Noah Davis",
      "email": "noah.davis@student.com",
      "role": "LEARNER",
      "demoUseCase": "STRUGGLING_LEARNER",
      "description": "Perfect for testing LEARNER_STRUGGLE, LESSON_PACING_SLOW insights. Has 3 quiz attempts with declining scores and high time spent on lessons.",
      "characteristics": [
        "3+ quiz attempts (triggers LEARNER_STRUGGLE)",
        "2400+ seconds on lesson-js-variables (triggers LESSON_PACING_SLOW)",
        "1800 seconds on lesson-js-intro (triggers LESSON_PACING_SLOW)"
      ]
    },
    {
      "userId": "learner1.id",
      "name": "Emma Wilson",
      "email": "emma.wilson@student.com",
      "role": "LEARNER",
      "demoUseCase": "SUCCESSFUL_LEARNER",
      "description": "Completed course1, in progress on course2. Perfect score on first quiz attempt. Good for baseline/normal behavior.",
      "characteristics": [
        "Completed JavaScript Fundamentals course",
        "100% score on first quiz attempt",
        "Consistent lesson completion times"
      ]
    },
    {
      "userId": "learner2.id",
      "name": "James Martinez",
      "email": "james.martinez@student.com",
      "role": "LEARNER",
      "demoUseCase": "IMPROVING_LEARNER",
      "description": "Had 2 quiz attempts, improved from 66.67% to 100%. Shows learner improvement pattern.",
      "characteristics": [
        "2 quiz attempts with improvement (66.67% → 100%)",
        "In progress on course1",
        "Normal lesson pacing"
      ]
    },
    {
      "userId": "instructor.id",
      "name": "Michael Chen",
      "email": "michael.chen@learnsphere.com",
      "role": "INSTRUCTOR",
      "demoUseCase": "COURSE_ADMIN",
      "description": "Course admin for both courses. Use for instructor dashboard and analytics views.",
      "characteristics": [
        "Admin of course-javascript-fundamentals",
        "Admin of course-react-essentials",
        "Can view all course insights"
      ]
    }
  ],

  "guaranteedScenarios": [
    {
      "scenarioId": "A",
      "name": "Learner Struggle - Quiz Multiple Attempts",
      "description": "Learner has made 3 attempts on the same quiz with declining/poor scores",
      "insightType": "LEARNER_STRUGGLE",
      "triggerCondition": "attempts >= 3 (Noah Davis already has 3 attempts)",
      "endpoint": "POST /api/quiz/submit",
      "method": "POST",
      "requestPayload": {
        "userId": "learner4.id",
        "quizId": "quiz-js-fundamentals",
        "attemptNumber": 4,
        "score": 33.33,
        "answers": [
          {
            "questionId": "q1-question-1",
            "selectedOptionId": "q1q1-opt1"
          },
          {
            "questionId": "q1-question-2",
            "selectedOptionId": "q1q2-opt3"
          },
          {
            "questionId": "q1-question-3",
            "selectedOptionId": "q1q3-opt1"
          }
        ]
      },
      "expectedResponse": {
        "alert": true,
        "type": "LEARNER_STRUGGLE",
        "message": "High retries or time spent"
      },
      "notes": "Noah Davis (learner4) already has 3 attempts. This 4th attempt will definitely trigger the insight."
    },
    {
      "scenarioId": "B",
      "name": "Lesson Pacing Slow - Excessive Time Spent",
      "description": "Learner takes >1.8x expected time on a lesson",
      "insightType": "LESSON_PACING_SLOW",
      "triggerCondition": "timeSpent > expectedTime * 1.8",
      "endpoint": "POST /api/lesson/complete",
      "method": "POST",
      "requestPayload": {
        "userId": "learner4.id",
        "lessonId": "lesson-js-intro",
        "timeSpentSeconds": 2000,
        "isCompleted": true
      },
      "expectedResponse": {
        "flag": true,
        "type": "LESSON_PACING_SLOW",
        "message": "Learner taking unusually long"
      },
      "calculation": {
        "lessonDuration": 840,
        "slowThreshold": "840 * 1.8 = 1512 seconds",
        "providedTime": 2000,
        "result": "2000 > 1512 ✓ TRIGGERS"
      },
      "alternativePayload": {
        "userId": "learner4.id",
        "lessonId": "lesson-js-variables",
        "timeSpentSeconds": 2500,
        "isCompleted": false,
        "calculation": "2500 > (1020 * 1.8 = 1836) ✓ TRIGGERS"
      }
    },
    {
      "scenarioId": "C",
      "name": "Course Dropoff - Multiple Low Completion Lessons",
      "description": "Course has ≥2 lessons with <50% completion rate among enrolled learners",
      "insightType": "COURSE_DROPOFF",
      "triggerCondition": "≥2 lessons with completion rate < 50%",
      "endpoint": "GET /api/insights/course/:courseId",
      "method": "GET",
      "courseId": "course-javascript-fundamentals",
      "expectedResponse": {
        "flag": true,
        "type": "COURSE_DROPOFF",
        "message": "Multiple lessons below 50% completion"
      },
      "courseAnalysis": {
        "courseId": "course-javascript-fundamentals",
        "totalEnrolledLearners": 3,
        "enrolledUsers": ["learner1.id", "learner2.id", "learner4.id"],
        "lessonCompletionRates": [
          {
            "lessonId": "lesson-js-intro",
            "completionRate": "100%",
            "completed": 3,
            "enrolled": 3
          },
          {
            "lessonId": "lesson-js-variables",
            "completionRate": "66.67%",
            "completed": 2,
            "enrolled": 3
          },
          {
            "lessonId": "lesson-js-functions",
            "completionRate": "33.33%",
            "completed": 1,
            "enrolled": 3,
            "triggersDropoff": true
          },
          {
            "lessonId": "lesson-js-objects",
            "completionRate": "33.33%",
            "completed": 1,
            "enrolled": 3,
            "triggersDropoff": true
          },
          {
            "lessonId": "lesson-js-es6",
            "completionRate": "33.33%",
            "completed": 1,
            "enrolled": 3,
            "triggersDropoff": true
          }
        ],
        "lessonsBelow50Percent": 3,
        "result": "3 >= 2 ✓ TRIGGERS COURSE_DROPOFF"
      },
      "alternateCourse": {
        "courseId": "course-react-essentials",
        "totalEnrolledLearners": 2,
        "lessonsBelow50Percent": 3,
        "result": "Also triggers COURSE_DROPOFF"
      }
    }
  ],

  "explicitIds": {
    "users": {
      "strugglingLearner": "learner4.id (Noah Davis)",
      "successfulLearner": "learner1.id (Emma Wilson)",
      "improvingLearner": "learner2.id (James Martinez)",
      "newLearner": "learner3.id (Olivia Brown)",
      "instructor": "instructor.id (Michael Chen)",
      "admin": "admin.id (Sarah Johnson)"
    },
    "courses": {
      "javascriptFundamentals": "course-javascript-fundamentals",
      "reactEssentials": "course-react-essentials"
    },
    "quizzes": {
      "jsFundamentalsQuiz": "quiz-js-fundamentals",
      "reactEssentialsQuiz": "quiz-react-essentials"
    },
    "lessons": {
      "course1": [
        "lesson-js-intro (840s duration, VIDEO)",
        "lesson-js-variables (1020s duration, VIDEO)",
        "lesson-js-functions (no duration, DOCUMENT)",
        "lesson-js-objects (1260s duration, VIDEO)",
        "lesson-js-es6 (1440s duration, VIDEO)"
      ],
      "course2": [
        "lesson-react-intro (960s duration, VIDEO)",
        "lesson-react-components (1140s duration, VIDEO)",
        "lesson-react-state (no duration, DOCUMENT)",
        "lesson-react-effects (1320s duration, VIDEO)",
        "lesson-react-advanced (no duration, IMAGE)"
      ]
    }
  },

  "copyPastePayloads": {
    "quizSubmit_TriggerStruggle": {
      "description": "4th attempt by Noah Davis - GUARANTEED to trigger LEARNER_STRUGGLE",
      "curl": "curl -X POST http://localhost:3000/api/quiz/submit \\\n  -H 'Content-Type: application/json' \\\n  -d '{\n    \"userId\": \"learner4.id\",\n    \"quizId\": \"quiz-js-fundamentals\",\n    \"attemptNumber\": 4,\n    \"score\": 33.33,\n    \"answers\": [\n      {\"questionId\": \"q1-question-1\", \"selectedOptionId\": \"q1q1-opt1\"},\n      {\"questionId\": \"q1-question-2\", \"selectedOptionId\": \"q1q2-opt1\"},\n      {\"questionId\": \"q1-question-3\", \"selectedOptionId\": \"q1q3-opt1\"}\n    ]\n  }'",
      "json": {
        "userId": "learner4.id",
        "quizId": "quiz-js-fundamentals",
        "attemptNumber": 4,
        "score": 33.33,
        "answers": [
          {"questionId": "q1-question-1", "selectedOptionId": "q1q1-opt1"},
          {"questionId": "q1-question-2", "selectedOptionId": "q1q2-opt1"},
          {"questionId": "q1-question-3", "selectedOptionId": "q1q3-opt1"}
        ]
      }
    },
    "lessonComplete_TriggerSlowPacing": {
      "description": "Noah Davis spending 2000s on 840s lesson - GUARANTEED to trigger LESSON_PACING_SLOW",
      "curl": "curl -X POST http://localhost:3000/api/lesson/complete \\\n  -H 'Content-Type: application/json' \\\n  -d '{\n    \"userId\": \"learner4.id\",\n    \"lessonId\": \"lesson-js-intro\",\n    \"timeSpentSeconds\": 2000,\n    \"isCompleted\": true\n  }'",
      "json": {
        "userId": "learner4.id",
        "lessonId": "lesson-js-intro",
        "timeSpentSeconds": 2000,
        "isCompleted": true
      }
    },
    "lessonComplete_Normal": {
      "description": "Emma Wilson completing lesson normally - NO alerts expected",
      "curl": "curl -X POST http://localhost:3000/api/lesson/complete \\\n  -H 'Content-Type: application/json' \\\n  -d '{\n    \"userId\": \"learner1.id\",\n    \"lessonId\": \"lesson-react-state\",\n    \"timeSpentSeconds\": 600,\n    \"isCompleted\": true\n  }'",
      "json": {
        "userId": "learner1.id",
        "lessonId": "lesson-react-state",
        "timeSpentSeconds": 600,
        "isCompleted": true
      }
    },
    "courseInsights_TriggerDropoff": {
      "description": "GET course insights - GUARANTEED to show COURSE_DROPOFF",
      "curl": "curl -X GET 'http://localhost:3000/api/insights/course/course-javascript-fundamentals'",
      "endpoint": "GET /api/insights/course/course-javascript-fundamentals"
    }
  },

  "insightThresholds": {
    "LEARNER_STRUGGLE": {
      "attempts": "≥ 3 quiz attempts",
      "timeSpent": "> 1800 seconds on any lesson"
    },
    "LESSON_PACING_SLOW": {
      "threshold": "timeSpent > expectedTime * 1.8"
    },
    "LESSON_PACING_FAST": {
      "threshold": "timeSpent < expectedTime * 0.3",
      "note": "NOT triggered by current seed data"
    },
    "COURSE_DROPOFF": {
      "threshold": "≥ 2 lessons with completion rate < 50%"
    }
  },

  "frontendTestingChecklist": [
    "✓ Test with learner4 (Noah Davis) for struggling learner UI",
    "✓ Test with learner1 (Emma Wilson) for successful learner UI",
    "✓ Submit quiz with 3+ attempts to trigger LEARNER_STRUGGLE alert",
    "✓ Complete lesson with 2000+ seconds to trigger LESSON_PACING_SLOW",
    "✓ View course-javascript-fundamentals to see COURSE_DROPOFF insight",
    "✓ Verify instructor dashboard shows all insights for their courses",
    "✓ Test normal flow with no alerts using learner1"
  ],

  "dataIntegrity": {
    "seedStatus": "UNCHANGED",
    "idsSource": "backend/prisma/seed.js",
    "verified": true,
    "allIdsExist": true
  }
}
